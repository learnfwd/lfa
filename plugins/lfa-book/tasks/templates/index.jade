doctype html
html(lang=book.language, dir=book.textDirection)
  head
    meta(charset='utf-8')
    meta(http-equiv='X-UA-Compatible', content='IE=edge, chrome=1')
    meta(name="viewport", content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui")

    title= book.title
    
    if !debug
      link(type='text/css', rel='stylesheet', media='screen', href='main.css?cache=' + cacheBlob)

  body
    .menu
      .menu-item.menu-item-left#leftbar-toggle: i.fa.fa-bars.fa-fw.menu-item-contents
      .menu-item.menu-item-right#rightbar-toggle: i.fa.fa-question.fa-fw.menu-item-contents
    .navigation-menu
      a.menu-item.menu-item-left#previous-chapter: i.fa.fa-chevron-left.menu-item-contents
      a.menu-item.menu-item-right#next-chapter: i.fa.fa-chevron-right.menu-item-contents
    
    nav#leftbar
      //- this will be done on runtime
      //- +toc(toc)
    
    #content
      #scrollview
        #textbook
          article
            section
              include ../../../lfa-core/frontend/js/templates/error-message.jade
    
    aside#rightbar
      p.text-center Nothing here yet.

    script.
      (function () {
        var moduleCache = {};

        function define(mod, deps, cb, autorun) {
          if (!(deps instanceof Array)) {
            autorun = cb; cb = deps; deps = [];
          }
          moduleCache[mod] = { 
            autorun: !!autorun,
            cb: cb, 
            deps: deps,
            hasRun: false,
            result: undefined,
          };
        }

        function require(mod) {
          if (moduleCache[mod].hasRun) {
            return moduleCache[mod].result;
          }
          moduleCache[mod].hasRun = true;
          var resolvedDeps = [];
          moduleCache[mod].deps.forEach(function (dep) {
            resolvedDeps.push(require(dep));
          });
          return moduleCache[mod].result = moduleCache[mod].cb.apply(window, resolvedDeps);
        }

        var require = require;
        function autorun() {
          for (var mod in moduleCache) {
            if (moduleCache[mod].autorun) {
              require(mod);
            }
          }
        }

        window.__lfa_autorun__ = autorun;
        window.__lfa_require__ = require;
        window.__lfa_define__ = define;
        window.require = require;
        window.define = define;
      })();

    if serve
      script(src='/webpack-dev-server.js')
    if debug
      script(src='book-commons.js?cache=' + cacheBlob)
      script(src='book-css-vendor.js?cache=' + cacheBlob)
      script(src='book-css-main.js?cache=' + cacheBlob)
    script(src='book.js?cache=' + cacheBlob)

    script.
      __lfa_autorun__();
