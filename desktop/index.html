<!DOCTYPE html>
<html>
<head>
  <title>Learn Forward Author Control Window</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="../patterns/lfa-components/js/lib/jquery-2.1.1.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
  <style>
    #cwd, #outputWindow {
      display: none;
    }

    #outputWindow {
      width: 100%;
      height: 670px;
      border: 0;
    }
  </style>
</head>
<body>
  <input type="file" id='cwd' value="C:\Users\Cristian\Documents\Code\textbook-demo" webkitdirectory />
  <iframe src="http://localhost:1111" id="outputWindow"></iframe>
  <script type="text/javascript">
    window.serverReady = function() {
      $('#outputWindow').show();
      $('#outputWindow')[0].src = $('#outputWindow')[0].src;
    };

    /*
     * LOAD LFA
     */
    var commands = require('../lib/commands');
    var configureOptions = require('../lib/config_parser');

    /*
     * MENUS
     */
    var gui = require('nw.gui');
    gui.Window.get().show();
    var ctrl = 'ctrl';

    var mainMenu = new gui.Menu({ type: 'menubar' });

    // TODO: check this on OSX
    //mainMenu.createMacBuiltin('LFA');

    var fileMenu = new gui.Menu();

    fileMenu.append(new gui.MenuItem({ label: '&New', enabled: false }));
    fileMenu.append(new gui.MenuItem({
      label: 'Open (Cmd/Ctrl + O)',
      key: 'o', modifiers: ctrl,
      click: function() {
        $cwd.trigger('click');
      }
    }));

    fileMenu.append(new gui.MenuItem({ type: 'separator' }));
    fileMenu.append(new gui.MenuItem({
      label: 'Exit (Cmd/Ctrl + Q)',
      key: 'q', modifiers: ctrl,
      click: function() {
        process.exit();
      }
    }));

    mainMenu.append(new gui.MenuItem({label: '&File', submenu: fileMenu, key: 'F'}));

    var watchMenuItem = new gui.MenuItem({
        label: '&Watch',
        click: function() {
          startWatching();
        },
        key: 'w',
        modifiers: 'alt',
        enabled: false
      });
    mainMenu.append(watchMenuItem);

    mainMenu.append(new gui.MenuItem({
      label: 'Edit Project',
      key: 'e', modifiers: ctrl,
      click: function() {
        var exec = require('child_process').exec;
        exec('"C:\\Program Files\\Sublime Text 3\\subl.exe" ' + process.cwd());
      }
    }));

    mainMenu.append(new gui.MenuItem({
      label: 'Dev Tools',
      key: 'd', modifiers: ctrl,
      click: function() {
         require('nw.gui').Window.get().showDevTools();
      }
    }));

    gui.Window.get().menu = mainMenu;
    /* END MENUS */

    process.stdout.write = function () {
      console.log(arguments);
    };

    var $cwd = $('#cwd');
    var cwd;

    $cwd.change(function() {
      cwd = $cwd.val();
      process.chdir(require('path').normalize(cwd));
      watchMenuItem.enabled = true;
    });

    var startWatching = function  () {
      configureOptions({}, function () {
        commands.watch.execute({cb: window.serverReady});
      });
    };
  </script>
</body>
</html>